# 师生助手系统优化任务清单

## 示例格式

### 任务一：修复大模型助手页面输入框被截断问题

**问题描述**
- 大模型助手页面的UI有问题，输入框被截断了
- 需要修复输入框的显示和布局问题

## 任务列表

### 任务五：修复大模型助手页面输入框被截断问题

**问题描述**
- 大模型助手页面的UI有问题，输入框被截断了
- 需要修复输入框的显示和布局问题

**待修复内容**
- 检查输入框容器的宽度设置
- 修复输入框被截断的问题
- 优化整体布局

### 任务七：整理并输出所有SQL文件

**任务描述**
- 空闲时间整理项目中的所有数据库相关文件
- 包含建表语句、初始数据、测试数据等
- 便于项目部署和文档管理

**待完成内容**
- 收集所有CREATE TABLE语句
- 整理INSERT初始数据语句
- 导出测试账户数据
- 创建统一的SQL文件集合
- 按功能模块分类整理

### 任务八：修复管理员登录后用户管理页面刷新消失问题

**问题描述**
- 管理员登录后可以正常访问用户管理页面
- 但刷新页面后，用户管理页面消失了
- 需要定位并修复此问题

**问题原因**
- 页面刷新时，`userInfo`从Pinia store中丢失
- 虽然`token`从localStorage恢复，但`userInfo`为null
- 路由守卫检查权限时因`userInfo`为空导致验证失败

**修复方案** ✅ 已完成
- 将用户信息也保存到localStorage
- 页面刷新时从localStorage恢复用户信息
- 修改文件：`frontend/src/stores/user.js`

**具体修改**
1. 初始化时从localStorage恢复用户信息
2. 登录成功后保存用户信息到localStorage
3. 检查登录状态后更新localStorage中的用户信息
4. 退出登录时清除localStorage中的用户信息

**修复效果**
- 管理员登录后刷新页面，用户管理页面正常显示
- 权限验证正常工作，不再被错误重定向

### 任务九：数据统计页面数据为0问题排查

**问题描述**
- 数据统计页面显示的总用户数、对话数等关键数据均为0
- 需要定位数据为0的根本原因

**待排查内容**
1. **数据库层面**
   - 检查数据库中是否存在用户数据 (user表)
   - 检查chat_record表中是否存在聊天记录数据
   - 检查message表中是否存在消息数据
   - 验证测试账户数据是否已正确插入

2. **后端API层面**
   - 检查StatisticsController中的接口实现
   - 验证用户数量统计接口 `/api/statistics/users/count`
   - 验证对话数量统计接口
   - 测试接口返回的实际数据

3. **前端层面**
   - 检查Statistics.vue中的数据获取逻辑
   - 验证ECharts图表的数据绑定
   - 排查是否存在请求失败或数据处理错误

### 任务十：在线用户数统计机制分析

**问题描述**
- 需要了解在线用户数是如何统计和计算的
- 当前系统如何判断用户是否在线

**待分析内容**
1. **在线状态判断逻辑**
   - 检查WebSocket连接状态
   - 查看用户最后活跃时间记录机制
   - 分析在线状态的时间窗口定义

2. **实现方式**
   - 是否基于WebSocket心跳检测
   - 还是基于Redis缓存用户状态
   - 或者是数据库字段记录最后活跃时间

3. **数据来源**
   - 查看Message.vue中的在线用户显示逻辑
   - 分析后端在线用户统计算法
   - 检查实时更新机制

### 任务十一：活跃用户趋势数据来源验证

**问题描述**
- 验证活跃用户趋势图表的数据来源
- 确认当前数据是否为模拟数据(mock data)

**待验证内容**
1. **数据来源分析**
   - 检查StatisticsController中活跃用户趋势接口
   - 查看 `/api/statistics/overview` 返回的数据
   - 验证数据库中是否有对应的活跃记录表

2. **Mock数据识别**
   - 如果是mock数据，定位mock代码位置
   - 分析mock数据的生成逻辑
   - 评估是否需要接入真实数据源

3. **真实数据实现**
   - 如果需要实现真实统计，设计数据采集方案
   - 考虑基于用户登录记录、聊天记录等计算活跃度
   - 设计合理的时间维度(日/周/月趋势)

